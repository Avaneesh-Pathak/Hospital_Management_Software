{% extends 'hms/base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto p-6">
    
    {% if messages %}
        <div class="bg-red-100 text-red-700 p-3 rounded-lg mb-4">
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Dashboard Overview -->
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Hospital Dashboard</h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <div class="bg-blue-200 text-black-800 p-6 rounded-lg shadow-md text-center">
            <h3 class="text-lg font-semibold">Total Patients</h3>
            <p class="text-4xl font-bold">{{ total_patients }}</p>
        </div>
        <div class="bg-green-200 text-black-800 p-6 rounded-lg shadow-md text-center">
            <h3 class="text-lg font-semibold">Total Doctors</h3>
            <p class="text-4xl font-bold">{{ total_doctors }}</p>
        </div>
        <div class="bg-teal-200 text-black-800 p-6 rounded-lg shadow-md text-center">
            <h3 class="text-lg font-semibold">Total Appointments</h3>
            <p class="text-4xl font-bold">{{ total_appointments }}</p>
        </div>
        <div class="bg-indigo-300 text-black-800 p-6 rounded-lg shadow-md text-center">
            <h3 class="text-lg font-semibold">Total Revenue</h3>
            <p class="text-4xl font-bold">â‚¹{{ total_revenue }}</p>
        </div>
        <div class="bg-red-200 text-black-800 p-6 rounded-lg shadow-md text-center">
            <h3 class="text-lg font-semibold">Emergency Cases Today</h3>
            <p class="text-4xl font-bold">{{ emergency_cases_today }}</p>
        </div>
    </div>
    
    <!-- Room Statistics -->
    <h2 class="text-2xl font-bold text-gray-900 mt-8 mb-4">Room Statistics</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        <div class="bg-gray-300 text-black-900 p-6 rounded-lg shadow-md text-center">
            <h3 class="text-lg font-semibold">Total Rooms</h3>
            <p class="text-4xl font-bold">{{ total_rooms }}</p>
        </div>
        <div class="bg-green-300 text-black-900 p-6 rounded-lg shadow-md text-center">
            <h3 class="text-lg font-semibold">Available Rooms</h3>
            <p class="text-4xl font-bold">{{ available_rooms_count }}</p>
        </div>
        <div class="bg-red-200 text-black-900 p-6 rounded-lg shadow-md text-center">
            <h3 class="text-lg font-semibold">Booked Rooms</h3>
            <p class="text-4xl font-bold">{{ booked_rooms }}</p>
        </div>
    </div>
    

    <!-- Rooms by Type -->
    <h3 class="text-2xl font-bold text-gray-800 mt-8 mb-4">Rooms by Type</h3>
    <div class="overflow-x-auto bg-white p-6 rounded-lg shadow-md">
        <table class="w-full border-collapse">
            <thead>
                <tr class="bg-gray-800 text-white">
                    <th class="p-3">Room Type</th>
                    <th class="p-3">Total Rooms</th>
                    <th class="p-3">Available Rooms</th>
                </tr>
            </thead>
            <tbody>
                {% for room_type, data in room_type_data.items %}
                <tr class="border-b text-center">
                    <td class="p-3">{{ room_type|title }}</td>
                    <td class="p-3">{{ data.total }}</td>
                    <td class="p-3">{{ data.available }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="p-5 text-center text-gray-600">No rooms available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Upcoming Appointments -->
    <h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4">Upcoming Appointments</h2>
    <div class="overflow-x-auto bg-white p-6 rounded-lg shadow-md">
        <table class="w-full border-collapse">
            <thead>
                <tr class="bg-gray-800 text-white">
                    <th class="p-3">Patient</th>
                    <th class="p-3">Doctor</th>
                    <th class="p-3">Date and Time</th>
                </tr>
            </thead>
            <tbody>
                {% for appointment in upcoming_appointments %}
                <tr class="border-b text-center">
                    <td class="p-3">
                        <a href="{% url 'patient_profile' appointment.patient.patient_code %}" 
                           class="text-blue-700 hover:underline">
                            {{ appointment.patient.user.full_name }}
                        </a>
                    </td>
                    
                    <td class="p-3 text-green-700">{{ appointment.doctor.user.full_name }}</td>
                    <td class="p-3 text-yellow-600">{{ appointment.date }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="p-5 text-center text-gray-600">No upcoming appointments</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Daily Patient Trends -->
    <h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4">Daily Patient Trends</h2>
    <div class="bg-white p-6 rounded-lg shadow-md">
        <canvas id="patientChart"></canvas>
    </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var ctx = document.getElementById('patientChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ daily_patient_labels|safe }},
                datasets: [{
                    label: 'Daily New Patients',
                    data: {{ daily_patient_data|safe }},
                    backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 3,
                    pointBackgroundColor: 'rgba(41, 128, 185, 1)',
                    pointBorderColor: 'white',
                    pointRadius: 5,
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' }
                },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#2c3e50' } },
                    y: { beginAtZero: true, grid: { color: 'rgba(200, 200, 200, 0.2)' }, ticks: { color: '#2c3e50' } }
                }
            }
        });
    });
</script>

{% endblock %}
